<%= render "shared/flash_message" %>

<% reaction_label = @type == "laugh" ? "笑える" : "深い" %>
<% reaction_icon  = @type == "laugh" ? "fa-regular fa-face-laugh-beam" : "fa-solid fa-lightbulb" %>
<% default_accent = @type == "laugh" ? "text-rose-500" : "text-emerald-500" %>

<div class="bg-gradient-to-b from-slate-900 via-rose-950/70 to-slate-950 min-h-screen py-16 px-4">
  <div class="max-w-5xl mx-auto space-y-10 text-white/90">
    <div class="text-center space-y-4">
      <p class="text-sm uppercase tracking-[0.4em] text-rose-200">リアクションランキング</p>
      <h1 class="text-3xl md:text-4xl font-bold text-white">みんなの<%= reaction_label %>ことわざ</h1>
      <p class="text-base text-slate-200">リアクションの数で人気の作品をランキング形式で紹介します。</p>
    </div>

    <div class="flex items-center justify-center gap-4">
      <% base_tab_classes = "w-40 px-6 py-3 rounded-full text-center font-semibold transition border" %>
      <%= link_to "笑える",
                  rankings_path(type: "laugh"),
                  class: "#{base_tab_classes} #{@type == 'laugh' ? 'bg-rose-500 text-white border-rose-400 shadow-lg shadow-rose-900/40' : 'bg-white/10 border-white/30 text-slate-200 hover:bg-white/20'}" %>
      <%= link_to "深い",
                  rankings_path(type: "deep"),
                  class: "#{base_tab_classes} #{@type == 'deep' ? 'bg-emerald-500 text-white border-emerald-400 shadow-lg shadow-emerald-900/30' : 'bg-white/10 border-white/30 text-slate-200 hover:bg-white/20'}" %>
    </div>

    <div class="bg-white/95 rounded-3xl shadow-2xl p-6 md:p-10 space-y-8 text-slate-800">
      <% if @proverbs.any? %>
        <ol class="space-y-4">
          <% @proverbs.each_with_index do |proverb, index| %>
            <% title = proverb.title.presence || [proverb.word1, proverb.word2].compact_blank.join(" × ") %>
            <% base_container_class = "rounded-2xl border p-5 flex flex-col gap-4" %>
            <% highlight = case index
                          when 0
                            { container: "bg-gradient-to-r from-amber-50 to-white border-amber-200 shadow-xl shadow-amber-200/60",
                              number: "text-amber-500",
                              accent: "text-amber-500",
                              badge: "bg-amber-100 text-amber-700 border border-amber-200",
                              badge_icon: "fa-solid fa-crown" }
                          when 1
                            { container: "bg-gradient-to-r from-slate-50 to-white border-slate-200 shadow-lg shadow-slate-200/60",
                              number: "text-slate-500",
                              accent: "text-slate-500",
                              badge: "bg-slate-100 text-slate-700 border border-slate-200",
                              badge_icon: "fa-regular fa-star" }
                          when 2
                            { container: "bg-gradient-to-r from-orange-50 to-white border-orange-200 shadow-lg shadow-orange-200/50",
                              number: "text-orange-500",
                              accent: "text-orange-500",
                              badge: "bg-orange-100 text-orange-700 border border-orange-200",
                              badge_icon: "fa-solid fa-medal" }
                          else
                            { container: "bg-white border-slate-100 shadow-sm",
                              number: default_accent,
                              accent: default_accent }
                          end %>
            <li class="<%= [base_container_class, highlight[:container]].compact.join(" ") %>">
              <div class="flex items-start gap-4">
                <span class="text-3xl font-black w-10 text-center <%= highlight[:number] %>"><%= index + 1 %></span>
                <div class="flex-1 space-y-2">
                  <% if highlight[:badge].present? %>
                    <span class="inline-flex items-center gap-2 px-3 py-1 text-xs font-semibold rounded-full <%= highlight[:badge] %>">
                      <i class="<%= highlight[:badge_icon] %>"></i>
                      トップ<%= index + 1 %>
                    </span>
                  <% end %>
                  <p class="text-lg md:text-xl font-bold text-slate-900"><%= title %></p>
                  <p class="text-sm text-slate-500">投稿日 <%= proverb.created_at.strftime("%Y.%m.%d") %></p>
                </div>
                <div class="flex flex-col items-center <%= highlight[:accent] %>">
                  <i class="<%= reaction_icon %> text-2xl"></i>
                  <span class="text-sm font-semibold text-slate-500 mt-1"><%= reaction_label %></span>
                  <span class="text-xl font-bold text-slate-900"><%= proverb.reactions_count || 0 %></span>
                </div>
              </div>

              <div class="flex flex-wrap items-center justify-between gap-3">
                <p class="text-sm text-slate-600"><%= proverb.meaning %></p>
                <%= link_to proverb_path(proverb),
                            class: "inline-flex items-center gap-2 text-sm font-semibold text-rose-500 hover:text-rose-400" do %>
                  詳細
                  <i class="fa-solid fa-arrow-right"></i>
                <% end %>
              </div>
            </li>
          <% end %>
        </ol>
      <% else %>
        <div class="text-center py-16 space-y-4">
          <p class="text-2xl font-semibold text-slate-500">まだ<%= reaction_label %>リアクションのランキングはありません。</p>
          <p class="text-slate-400">気になることわざにリアクションして最初のランキングを作りましょう。</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
