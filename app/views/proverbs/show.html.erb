<%= render "shared/flash_message" %>
<div class="bg-gradient-to-b from-slate-900 via-rose-950/70 to-slate-950 min-h-screen py-16 px-4">
  <div class="max-w-md sm:max-w-xl lg:max-w-5xl mx-auto 
            grid gap-4 sm:gap-6 lg:grid-cols-[2fr,1fr] lg:gap-8">

  <div class="bg-white/95 rounded-3xl shadow-2xl 
              p-4 sm:p-6 md:p-8 lg:p-10 space-y-6 lg:space-y-10
              transition hover:-translate-y-1 hover:shadow-rose-200/60">

      <div class="text-center text-slate-500">
        <p class="text-sm">タイトル</p>
      </div>

      <div class="border border-slate-200 rounded-3xl p-6 bg-slate-50">
        <p class="text-2xl font-bold text-center text-slate-900"><%= @proverb.title %></p>
      </div>

      <div class="space-y-6 text-slate-800">
        <section class="space-y-2">
          <p class="text-center text-xs font-semibold uppercase tracking-[0.4em] text-slate-400">意味</p>
          <div class="font-bold rounded-2xl border border-slate-200 bg-white/70 p-6 leading-relaxed">
            <%= simple_format(@proverb.meaning, {}, wrapper_tag: "p") %>
          </div>
        </section>
        <section class="space-y-2">
          <p class="text-center text-xs font-semibold uppercase tracking-[0.4em] text-slate-400">用例</p>
          <div class="font-bold rounded-2xl border border-slate-200 bg-white/70 p-6 leading-relaxed">
            <%= simple_format(@proverb.example, {}, wrapper_tag: "p") %>
          </div>
        </section>
      </div>

      <div class="border-t border-slate-100 pt-6">
        <p class="text-center text-xs font-semibold uppercase tracking-[0.4em] text-slate-400 mb-4">作り手</p>
        <% contributors = @proverb.proverb_contributors.limit(2).map(&:user).compact %>
        <% if contributors.any? %>
          <div class="flex flex-col sm:flex-row items-center justify-center gap-4 sm:gap-6 text-center">
            <% contributors.each_with_index do |user, index| %>
              <%= link_to user_path(user), class: "flex items-center gap-3 bg-slate-50 border border-slate-100 rounded-2xl px-4 py-3 hover:border-rose-200 transition" do %>
                <% if user.avatar.attached? %>
                  <%= image_tag user.avatar.variant(resize_to_fill: [48, 48]),
                                class: "h-12 w-12 rounded-full object-cover border border-rose-100 shadow" %>
                <% else %>
                  <div class="h-12 w-12 rounded-full bg-rose-100 text-rose-600 flex items-center justify-center text-base font-semibold border border-rose-200 shadow">
                    <%= (user.name.presence || "?").first.upcase %>
                  </div>
                <% end %>
                <div>
                  <p class="text-lg font-semibold text-slate-900"><%= user.name %></p>
                </div>
              <% end %>
              <% if index.zero? && contributors.length > 1 %>
                <span class="text-3xl font-black text-rose-400">×</span>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>

      <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
        <%= link_to "一覧に戻る", proverbs_path,
                    class: "text-rose-500 hover:text-rose-400 font-semibold" %>
        <div class="flex items-center gap-4 flex-wrap">
          <% if user_signed_in? && current_user.id == @proverb.proverb_contributors.first.user_id %>
            <%= link_to edit_proverb_path, class: "text-slate-400 hover:text-rose-400 transition" do %>
              <i class="fa-solid fa-pen-to-square text-2xl"></i>
            <% end %>
            <%= link_to proverb_path(@proverb),
                        method: :delete,
                        data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" },
                        class: "text-slate-400 hover:text-rose-500 transition" do %>
              <i class="fa-solid fa-trash text-2xl"></i>
            <% end %>
          <% end %>
          <div class="flex items-center gap-6 text-slate-500">
            <%= render "reactions/block", reactable: @proverb %>
          </div>
          <div class="flex items-center gap-4 justify-start sm:justify-center text-slate-500">
            <% prepare_meta_tags @proverb %>
            <% twitter_params = { url: proverb_url(@proverb), text: "#{@proverb.title}\n#ないないことわざ" } %>
            <% twitter_share_url = "https://twitter.com/intent/tweet?#{URI.encode_www_form(twitter_params)}" %>
            <%= link_to twitter_share_url,
                        target: '_blank',
                        rel: 'noopener',
                        data: { toggle: "tooltip", placement: "bottom" },
                        title: "Xでシェア",
                        class: "flex items-center justify-center" do %>
              <i class="fa-brands fa-square-x-twitter fa-2xl"></i>
            <% end %>

            <div class="line-share-button flex justify-center items-center">
              <div class="line-it-button" 
                   data-lang="ja" 
                   data-type="share-a" 
                   data-env="REAL"
                   data-url="<%= proverb_url(@proverb) %>" 
                   data-text="<%= @proverb.title %>" 
                   data-color="default" 
                   data-size="large" 
                   data-count="true" 
                   data-ver="3" 
                   style="display: none;">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <aside class="bg-white/95 border border-rose-50 rounded-3xl shadow-xl p-6 space-y-6">
      <div class="text-center space-y-2">
        <h3 class="text-2xl font-bold text-slate-900">感想を届けよう</h3>
      </div>

      <div id="comments" class="space-y-4 max-h-[420px] overflow-y-auto pr-2">
        <% @comments.each do |comment| %>
          <%= render "shared/comment", comment: comment %>
        <% end %>
      </div>

      <div id="new_comment_form">
        <%= form_with model: [@proverb, @comment] do |f| %>
          <div class="space-y-2">
            <%= f.text_area :content,
                            rows: 3,
                            placeholder: "コメントを入力…",
                            class: "w-full border border-rose-100 rounded-2xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-rose-300" %>
          </div>
          <div class="mt-3 text-right">
            <%= f.submit "送信",
                         class: "bg-rose-500 hover:bg-rose-400 text-white font-semibold py-2 px-6 rounded-2xl shadow transition" %>
          </div>
        <% end %>
      </div>
    </aside>
  </div>
</div>
