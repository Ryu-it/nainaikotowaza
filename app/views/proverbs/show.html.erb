<%= render "shared/flash_message" %>
<div class="flex justify-center min-h-screen bg-gradient-to-b from-slate-900 via-rose-950/70 to-slate-950">
  <div class="w-full max-w-4xl px-4 py-12">
    <div class="flex flex-col">
      <div class="flex-1">
        <div class="mb-4 mt-4 bg-pink-50 border border-pink-100 rounded-2xl shadow-sm px-10 py-12">
          <div class="max-w-2xl mx-auto">
          <div class="space-y-10">
            <div class="flex items-center justify-center space-x-6 text-xl font-medium text-gray-900 px-6 py-4">
  <!-- 左のユーザー -->
  <div class="flex items-center space-x-2">
    <% user = @proverb.proverb_contributors.first.user %>
    <%= link_to user_path(user), class: "flex items-center space-x-2 hover:opacity-80 transition" do %>
    <% if user.avatar.attached? %>
      <%= image_tag user.avatar.variant(resize_to_fill: [40, 40]),
                    class: "h-12 w-12 rounded-full object-cover border border-rose-100 shadow-sm" %>
    <% else %>
      <div class="h-12 w-12 rounded-full bg-rose-100 text-rose-600 flex items-center justify-center text-sm font-semibold border border-rose-200 shadow-sm">
        <%= (user.name.presence || "?").first.upcase %>
      </div>
    <% end %>
    <span><%= user.name %></span>
    <% end %>
  </div>

  <!-- 区切りの × -->
  <% if @proverb.proverb_contributors.second&.user.present? %>
    <span class="text-gray-700 text-xl">×</span>

    <!-- 右のユーザー -->
    <div class="flex items-center space-x-2">
      <% user = @proverb.proverb_contributors.second.user %>
      <%= link_to user_path(user), class: "flex items-center space-x-2 hover:opacity-80 transition" do %>
      <% if user.avatar.attached? %>
        <%= image_tag user.avatar.variant(resize_to_fill: [40, 40]),
                      class: "h-12 w-12 rounded-full object-cover border border-rose-100 shadow-sm" %>
      <% else %>
        <div class="h-12 w-12 rounded-full bg-rose-100 text-rose-600 flex items-center justify-center text-sm font-semibold border border-rose-200 shadow-sm">
          <%= (user.name.presence || "?").first.upcase %>
        </div>
      <% end %>
      <span><%= user.name %></span>
      <% end %>
    </div>
  <% end %>
</div>


            <div class="space-y-8">
              <%# タイトル %>
              <div>
                <h2 class="text-center text-gray-700 mb-2">ことわざ</h2>
                <div class="text-center text-lg font-medium text-gray-900 bg-white border rounded-xl px-4 py-3">
                  <%= @proverb.title %>
                </div>
              </div>

              <%# 意味 %>
              <section>
                <h2 class="text-center text-gray-700 mb-2">意味</h2>
                <div class="text-center bg-white border rounded-xl px-4 py-4 leading-relaxed text-gray-900">
                  <%= @proverb.meaning %>
                </div>
              </section>

              <%# 用例 %>
              <section>
                <h2 class="text-center text-gray-700 mb-2">用例</h2>
                <div class="text-center bg-white border rounded-xl px-4 py-4 leading-relaxed text-gray-900">
                  <%= @proverb.example %>
                </div>
              </section>
            </div>
          </div>
          </div>

          <%# 任意：戻るリンク %>
          <div class="mt-8 text-center">
            <%= link_to "一覧に戻る", proverbs_path, class: "text-pink-700 hover:underline" %>
          </div>

          <% if user_signed_in? && current_user.id == @proverb.proverb_contributors.first.user_id %>
          <div class="mt-8 text-center">
            <%= link_to edit_proverb_path, class: "text-pink-700 hover:underline" do %>
              <i class="fa-solid fa-pen-to-square text-2xl"></i>
            <% end %>
            <%= link_to proverb_path(@proverb), method: :delete, data: { turbo_method: :delete, turbo_confirm: "本当に削除しますか？" }, class: "text-pink-700 hover:underline ml-4" do %>
              <i class="fa-solid fa-trash text-2xl"></i>
            <% end %>
          </div>
          <% end %>
          <div class="flex justify-center items-center gap-8 mt-8">
            <%= render "reactions/laugh", reactable: @proverb %>
            <%= render "reactions/deep", reactable: @proverb %>
          </div>

          <div class="text-gray-600">
  <%# 設定したメタタグを描画前に呼び出す %>
  <% prepare_meta_tags @proverb %>

  <% twitter_params = {
       url:  proverb_url(@proverb),
       text: "#{@proverb.title}\n#ないないことわざ"
     } %>
  <% twitter_share_url = "https://twitter.com/intent/tweet?#{URI.encode_www_form(twitter_params)}" %>

  <%= link_to twitter_share_url,
              target: '_blank',
              rel: 'noopener',
              data: { toggle: "tooltip", placement: "bottom" },
              title: "Xでシェア" do %>
    <i class="fa-brands fa-square-x-twitter fa-2xl"></i>
  <% end %>
</div>


        </div>
      </div>

      <aside class="bg-white border border-rose-100 rounded-2xl shadow-sm p-4 mt-8 lg:mt-4">
        <h3 class="text-lg font-semibold text-rose-600 mb-2">コメント</h3>

        <% @comments.each do |comment| %>
          <%= render "shared/comment", comment: comment %>
        <% end %>

        <%= form_with model: [@proverb, @comment], local: true do |f| %>
          <div>
            <%= f.text_area :content, rows: 3, placeholder: "コメントを入力…",
                class: "w-full border border-rose-200 rounded p-2 focus:outline-none focus:ring-2 focus:ring-rose-500" %>
          </div>
          <div class="mt-3 text-right">
            <%= f.submit "送信", class: "bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-xl shadow transition" %>
          </div>
        <% end %>
      </aside>
    </div>
  </div>
</div>
